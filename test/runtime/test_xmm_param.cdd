/**
 * @file test_xmm_param.cdd
 * @brief XMM 寄存器传参测试
 *
 * 测试内容：
 * 1. 浮点参数通过 XMM0-XMM7 传递
 * 2. 浮点返回值通过 XMM0 返回
 * 3. 整数和浮点参数混合传递
 * 4. 多浮点参数函数调用
 *
 * EXPECT_EXIT: 42
 */

// ============================================================================
// 单浮点参数函数
// ============================================================================

double identity(double x) {
    return x;
}

double negate(double x) {
    return -x;
}

// ============================================================================
// 双浮点参数函数
// ============================================================================

double add(double a, double b) {
    return a + b;
}

double sub(double a, double b) {
    return a - b;
}

double mul(double a, double b) {
    return a * b;
}

double div_f(double a, double b) {
    return a / b;
}

// ============================================================================
// 混合参数函数（整数 + 浮点）
// ============================================================================

double mix_if(int a, double b) {
    return a + b;
}

double mix_fi(double a, int b) {
    return a + b;
}

double mix_ifi(int a, double b, int c) {
    return a + b + c;
}

double mix_fif(double a, int b, double c) {
    return a + b + c;
}

// ============================================================================
// 多浮点参数函数（测试 XMM0-XMM7）
// ============================================================================

double sum4(double a, double b, double c, double d) {
    return a + b + c + d;
}

double sum6(double a, double b, double c, double d, double e, double f) {
    return a + b + c + d + e + f;
}

double sum8(double a, double b, double c, double d,
            double e, double f, double g, double h) {
    return a + b + c + d + e + f + g + h;
}

// ============================================================================
// 主测试函数
// ============================================================================

int main(void) {
    int result = 0;
    
    // ========================================
    // 测试 1：单参数函数
    // ========================================
    
    double v1 = identity(5.0);
    if (v1 > 4.9 && v1 < 5.1) {
        result = result + 2;  // +2 = 2
    }
    
    double v2 = negate(3.0);
    if (v2 > -3.1 && v2 < -2.9) {
        result = result + 2;  // +2 = 4
    }
    
    // ========================================
    // 测试 2：双参数函数
    // ========================================
    
    double v3 = add(2.5, 3.5);
    if (v3 > 5.9 && v3 < 6.1) {
        result = result + 2;  // +2 = 6
    }
    
    double v4 = sub(10.0, 3.0);
    if (v4 > 6.9 && v4 < 7.1) {
        result = result + 2;  // +2 = 8
    }
    
    double v5 = mul(4.0, 2.5);
    if (v5 > 9.9 && v5 < 10.1) {
        result = result + 2;  // +2 = 10
    }
    
    double v6 = div_f(15.0, 3.0);
    if (v6 > 4.9 && v6 < 5.1) {
        result = result + 2;  // +2 = 12
    }
    
    // ========================================
    // 测试 3：混合参数
    // ========================================
    
    double v7 = mix_if(3, 4.5);
    if (v7 > 7.4 && v7 < 7.6) {
        result = result + 3;  // +3 = 15
    }
    
    double v8 = mix_fi(4.5, 3);
    if (v8 > 7.4 && v8 < 7.6) {
        result = result + 3;  // +3 = 18
    }
    
    double v9 = mix_ifi(2, 3.5, 4);
    if (v9 > 9.4 && v9 < 9.6) {
        result = result + 3;  // +3 = 21
    }
    
    double v10 = mix_fif(2.5, 3, 4.5);
    if (v10 > 9.9 && v10 < 10.1) {
        result = result + 3;  // +3 = 24
    }
    
    // ========================================
    // 测试 4：多浮点参数
    // ========================================
    
    double v11 = sum4(1.0, 2.0, 3.0, 4.0);
    if (v11 > 9.9 && v11 < 10.1) {
        result = result + 4;  // +4 = 28
    }
    
    double v12 = sum6(1.0, 2.0, 3.0, 4.0, 5.0, 6.0);
    if (v12 > 20.9 && v12 < 21.1) {
        result = result + 4;  // +4 = 32
    }
    
    double v13 = sum8(1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0);
    if (v13 > 35.9 && v13 < 36.1) {
        result = result + 5;  // +5 = 37
    }
    
    // ========================================
    // 测试 5：链式调用
    // ========================================
    
    double v14 = add(mul(2.0, 3.0), div_f(8.0, 2.0));  // 6.0 + 4.0 = 10.0
    if (v14 > 9.9 && v14 < 10.1) {
        result = result + 5;  // +5 = 42
    }
    
    return result;  // EXPECT_EXIT: 42
}
